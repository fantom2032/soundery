{% extends "base.html" %}
{% block content %}
<h2>{{ track.title }}</h2>

{% if track.cover %}
    <img src="{{ track.cover.url }}" alt="–û–±–ª–æ–∂–∫–∞" width="200">
{% endif %}

<audio controls style="display:block; margin-top:10px;">
    <source src="{{ track.audio_file.url }}" type="audio/mpeg">
    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ.
</audio>

<p>–ó–∞–≥—Ä—É–∑–∏–ª: 
  {% if track.uploaded_by %}
      <a href="{% url 'user_profile' track.uploaded_by.username %}">
          {{ track.uploaded_by.username }}
      </a>
  {% else %}
      –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  {% endif %}
</p>



{% if user.is_authenticated %}
    <form action="{% url 'like_track' track.pk %}" method="post">
        {% csrf_token %}
        {% if user_liked %}
            <button type="submit">üíî –£–±—Ä–∞—Ç—å –ª–∞–π–∫</button>
        {% else %}
            <button type="submit">‚ù§Ô∏è –õ–∞–π–∫–Ω—É—Ç—å</button>
        {% endif %}
    </form>
{% else %}
    <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫.</p>
{% endif %}

<hr>

<h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>

{% if user.is_authenticated %}
    <h4>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
    <form method="post">
        {% csrf_token %}
        <textarea name="text" rows="3" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>
{% else %}
    <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å.</p>
{% endif %}

<ul style="list-style-type: none; padding-left: 0;">
    {% for comment in comments %}
        <li style="margin-bottom: 15px;">
            <strong>{{ comment.user.username }}</strong>: {{ comment.text }}
            <br>
            <small>{{ comment.created_at|date:"d.m.Y H:i" }}</small>

            {% if user.is_authenticated %}
                <form method="post" style="margin-top: 5px;">
                    {% csrf_token %}
                    <input type="hidden" name="parent_id" value="{{ comment.id }}">
                    <textarea name="text" rows="1" placeholder="–û—Ç–≤–µ—Ç–∏—Ç—å..." required></textarea>
                    <button type="submit">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                </form>
            {% endif %}

            {% if comment.replies.all %}
                <ul style="margin-left: 20px; list-style-type: none;">
                    {% for reply in comment.replies.all %}
                        <li style="margin-top: 10px;">
                            <strong>{{ reply.user.username }}</strong>: {{ reply.text }}
                            <br>
                            <small>{{ reply.created_at|date:"d.m.Y H:i" }}</small>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
        </li>
    {% empty %}
        <li>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</li>
    {% endfor %}
</ul>



{% endblock %}
